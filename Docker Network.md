도커 네트워킹에 대한 전체 개요와 주요 개념을 한국어로 상세하게 설명해드리겠습니다. 도커 네트워킹은 도커의 핵심 기능 중 하나로, 컨테이너 간의 통신뿐만 아니라 외부 네트워크와의 연결을 가능하게 합니다. 도커 네트워킹은 여러 종류의 네트워크 드라이버와 구성 요소를 통해 다양한 방식으로 네트워크 환경을 제공합니다. 아래에서는 도커 네트워킹의 주요 개념들을 다룹니다.

### 도커 네트워킹의 핵심 개념
1. **컨테이너 네트워크 모델 (CNM)**
2. **libnetwork**
3. **네트워크 드라이버**

#### 1. 컨테이너 네트워크 모델 (CNM)
도커 네트워킹의 기본 설계 사양이 바로 컨테이너 네트워크 모델 (Container Network Model, CNM)입니다. CNM은 도커 네트워크의 구성 요소와 설계를 정의하는 가이드 역할을 합니다. CNM은 크게 세 가지 주요 구성 요소를 정의합니다:
- **샌드박스 (Sandbox)**: 샌드박스는 네트워크 스택을 독립적으로 격리하는 개념입니다. 이 안에는 이더넷 인터페이스, 포트, 라우팅 테이블, DNS 설정 등이 포함됩니다. 샌드박스는 각 컨테이너에게 독립적인 네트워크 환경을 제공합니다.
- **엔드포인트 (Endpoint)**: 엔드포인트는 가상 네트워크 인터페이스로, 실제 네트워크 인터페이스와 유사하게 작동합니다. CNM에서는 엔드포인트가 샌드박스를 네트워크와 연결하는 역할을 합니다. 즉, 컨테이너가 네트워크에 접근할 수 있도록 연결하는 가상의 통로 역할을 합니다.
- **네트워크 (Network)**: 네트워크는 여러 엔드포인트를 그룹화하여 서로 통신할 수 있게 하는 소프트웨어 기반의 스위치입니다. 예를 들어, 브리지(bridge) 네트워크는 여러 컨테이너의 엔드포인트를 그룹화하여 서로 통신하도록 합니다.

#### 2. libnetwork
libnetwork는 CNM을 실제로 구현한 라이브러리로, 도커 네트워킹의 모든 주요 기능을 담당합니다. 이 라이브러리는 Go 언어로 작성되었으며, 리눅스와 윈도우 환경 모두에서 사용 가능합니다. 초창기 도커에서는 모든 네트워크 코드가 도커 데몬에 통합되어 있었으나, 이러한 구조는 유지 보수에 어려움을 주었습니다. 이후 도커 네트워크 코드는 libnetwork라는 외부 라이브러리로 분리되었으며, 모듈화된 구조를 통해 더 유연하고 효율적으로 관리할 수 있게 되었습니다. libnetwork는 네트워크 서비스 발견(service discovery) 및 컨테이너 간 부하 분산(load balancing) 등의 기능도 제공합니다.

#### 3. 네트워크 드라이버 (Drivers)
libnetwork가 네트워크의 제어 및 관리 기능을 구현한다면, 네트워크 드라이버는 실제 데이터 전송을 담당합니다. 도커는 다양한 내장 드라이버를 제공하며, 각 드라이버는 고유한 네트워크 토폴로지를 구현합니다. 예를 들어:
- **Bridge 드라이버**: 단일 호스트 내에서 작동하며, 동일한 호스트에 있는 여러 컨테이너를 연결합니다.
- **Overlay 드라이버**: 여러 호스트에 걸쳐 있는 컨테이너들을 하나의 네트워크로 연결합니다.
- **MACVLAN 드라이버**: 컨테이너가 외부 네트워크와 직접 통신할 수 있도록 별도의 MAC 주소와 IP 주소를 부여합니다.

또한, 도커는 외부 네트워크 드라이버나 플러그인을 사용하여 네트워킹을 확장할 수 있도록 합니다. 대표적인 예로 Weave Net과 같은 외부 네트워크 드라이버가 있습니다.

### 단일 호스트 브리지 네트워크 (Single-Host Bridge Networks)
단일 호스트 브리지 네트워크는 도커 네트워크 중 가장 간단한 형태입니다. 브리지 네트워크는 주로 단일 호스트 내에서 여러 컨테이너를 연결하기 위해 사용됩니다. 기본적으로 리눅스에서는 **bridge** 드라이버를 사용하여 이러한 네트워크를 생성하며, 윈도우에서는 **nat** 드라이버가 사용됩니다. 이 기본 브리지 네트워크는 모든 새로운 컨테이너가 기본적으로 연결되는 네트워크입니다.

**예시 명령어**:
- `docker network ls`: 현재 도커 호스트에 존재하는 네트워크 목록을 출력합니다.
- `docker network create localnet`: 새로운 단일 호스트 브리지 네트워크를 생성합니다.
- `docker network inspect`: 특정 네트워크의 상세 정보를 확인합니다.

### 포트 매핑 (Port Mappings)
브리지 네트워크에 연결된 컨테이너들은 기본적으로 동일한 네트워크 내의 컨테이너와만 통신이 가능합니다. 하지만 포트 매핑을 통해 외부 네트워크와 통신할 수 있습니다. 포트 매핑을 사용하면 컨테이너의 특정 포트를 도커 호스트의 포트에 매핑하여 외부에서 컨테이너에 접근할 수 있게 됩니다.

**예시**: 웹 서버 컨테이너의 80번 포트를 도커 호스트의 5000번 포트에 매핑하여 외부에서 접근할 수 있게 할 수 있습니다.
- `docker run -d -p 5000:80 nginx`: nginx 웹 서버를 실행하면서 컨테이너의 80번 포트를 호스트의 5000번 포트로 매핑합니다.

### 멀티 호스트 오버레이 네트워크 (Multi-Host Overlay Networks)
오버레이 네트워크는 여러 호스트에 걸쳐 있는 컨테이너들을 하나의 네트워크로 연결할 수 있도록 합니다. 이는 특히 컨테이너들이 서로 다른 호스트에 있을 때 직접 통신할 수 있도록 해줍니다. 이러한 오버레이 네트워크는 클러스터 내 여러 노드에 걸쳐 서비스를 배포하는 데 유리합니다.

**명령어**:
- `docker network create -d overlay overnet`: 오버레이 드라이버를 사용하여 "overnet"이라는 네트워크를 생성합니다.

### MACVLAN 네트워크
MACVLAN 드라이버는 각 컨테이너가 독립적인 MAC 주소와 IP 주소를 갖도록 하여, 컨테이너가 외부 네트워크와 직접 통신할 수 있게 합니다. 이는 컨테이너가 물리적 네트워크에 연결된 것과 동일한 상태를 만들어주므로, 특히 기존의 물리적 네트워크와 통합이 필요할 때 유용합니다.

### 컨테이너 및 서비스 로그 (Container and Service Logs)
도커에서 네트워크 문제를 해결할 때 가장 먼저 확인해야 할 것은 도커 데몬 로그와 컨테이너 로그입니다.
- **데몬 로그**: 리눅스 시스템에서 도커 데몬 로그는 `/var/log` 경로에 저장되며, `journalctl -u docker.service` 명령어로 확인할 수 있습니다.
- **컨테이너 로그**: `docker container logs` 명령어를 통해 특정 컨테이너의 로그를 확인할 수 있습니다.

도커는 여러 종류의 로그 드라이버를 지원하며, 기본적으로 **json-file** 형식으로 로그를 기록합니다. 다른 로그 드라이버로는 **journald**, **syslog**, **splunk** 등이 있으며, 이를 통해 로그를 외부 시스템에 통합할 수 있습니다.

### 서비스 발견 (Service Discovery)
서비스 발견 기능은 컨테이너들이 서로 이름을 통해 쉽게 찾을 수 있도록 합니다. 이는 도커의 내장 DNS 서버와 각 컨테이너의 로컬 DNS 리졸버를 통해 이루어집니다. 모든 컨테이너는 기본적으로 DNS 리졸버를 갖추고 있으며, 이를 통해 같은 네트워크에 있는 다른 컨테이너를 이름으로 쉽게 찾을 수 있습니다.

### Ingress 로드 밸런싱 (Ingress Load Balancing)
도커 스웜(Swarm)은 클러스터 외부에서 접근할 수 있도록 서비스를 공개할 때 두 가지 모드를 지원합니다:
1. **Ingress 모드**: 클러스터 내의 모든 노드에서 서비스를 접근할 수 있도록 합니다.
2. **호스트 모드**: 특정 서비스가 실행 중인 노드에서만 접근할 수 있도록 합니다.

Ingress 모드는 스웜의 기본 모드이며, 클러스터 내의 모든 노드에서 특정 포트로 접근하면 서비스로 트래픽을 전달하는 역할을 합니다.

### 주요 도커 네트워크 명령어
- `docker network ls`: 네트워크 목록을 나열합니다.
- `docker network create`: 새로운 도커 네트워크를 생성합니다.
- `docker network inspect`: 네트워크의 상세 정보를 제공합니다.
- `docker network prune`: 사용되지 않는 네트워크를 삭제합니다.
- `docker network rm`: 특정 네트워크를 삭제합니다.

도커 네트워킹은 다양한 네트워크 구성과 컨테이너 간의 복잡한 통신을 가능하게 하며, 이를 통해 더 유연하고 강력한 애플리케이션 아키텍처를 구현할 수 있습니다. 위에서 설명한 주요 개념과 명령어들을 잘 이해하고 사용하면 도커 네트워킹을 효과적으로 활용할 수 있을 것입니다.