### Docker와 Linux 보안 기술 개요
Docker는 다양한 보안 기술을 제공하며, Linux의 고급 보안 기능과 자체적인 보안 기술들을 통해 안전한 컨테이너 환경을 구축합니다. 이 과정에서 **네임스페이스(namespaces)**, **컨트롤 그룹(cgroups)**, **케이퍼빌러티(capabilities)**, **강제 접근 제어 시스템(MAC)**, **seccomp**, 그리고 **Docker Swarm 모드**의 보안 기술을 사용합니다. 각 보안 기술의 세부 내용을 아래에서 설명하겠습니다.

#### 1. 네임스페이스 (Namespaces)
네임스페이스는 Docker 컨테이너가 서로 격리된 환경에서 동작할 수 있도록 해주는 핵심 기술입니다. **Linux 커널 네임스페이스**는 하나의 운영 체제를 여러 개의 격리된 환경으로 나누어 마치 각각이 독립적인 운영 체제처럼 보이고 동작하게 만듭니다.

**Docker에서 사용되는 네임스페이스 종류**:
- **Process ID (pid) 네임스페이스**: 각 컨테이너는 고유한 프로세스 트리를 가집니다. 이를 통해 하나의 컨테이너가 다른 컨테이너의 프로세스를 볼 수 없으며, 호스트 시스템의 프로세스 트리도 접근할 수 없습니다.
- **Network (net) 네임스페이스**: 각 컨테이너에 고유한 네트워크 스택을 제공합니다. 여기에는 네트워크 인터페이스, IP 주소, 포트 범위 등이 포함됩니다.
- **Mount (mnt) 네임스페이스**: 각 컨테이너는 고유한 파일 시스템을 가집니다. 예를 들어, `/etc`, `/var`, `/dev` 등과 같은 시스템 파일 구조를 독립적으로 가질 수 있어, 다른 컨테이너와 격리된 상태로 작업이 가능합니다.
- **Inter-process Communication (ipc) 네임스페이스**: 컨테이너 내에서 공유 메모리에 접근하기 위한 격리된 공간을 제공합니다. 이를 통해 컨테이너가 외부의 공유 메모리에 접근하지 못하게 하여 보안을 강화합니다.
- **User (user) 네임스페이스**: 컨테이너 내의 사용자를 호스트 시스템의 다른 사용자로 매핑할 수 있도록 합니다. 주로 컨테이너 내의 루트 사용자를 호스트의 비-루트 사용자로 매핑하여 보안을 강화합니다.
- **UTS (Unix Timesharing System) 네임스페이스**: 각 컨테이너에 고유한 호스트 이름을 제공합니다.

네임스페이스는 서로 다른 컨테이너의 리소스가 겹치지 않도록 **격리**하는 역할을 합니다. 하지만 네임스페이스만으로는 격리가 완전하지 않기 때문에 추가적인 보안 기술이 필요합니다.

#### 2. 컨트롤 그룹 (Control Groups, cgroups)
**컨트롤 그룹(cgroups)**은 각 컨테이너가 사용할 수 있는 시스템 자원을 제한하는 데 사용됩니다. 네임스페이스가 프로세스를 **격리**하는 역할을 한다면, **cgroups**는 리소스 사용을 **제한**하는 역할을 합니다.

컨테이너가 CPU, 메모리, 네트워크 대역폭, 디스크 I/O와 같은 자원을 무한정 사용할 수 없도록 제한함으로써, **특정 컨테이너가 시스템의 모든 자원을 독점하여 다른 컨테이너에 영향을 미치거나 서비스 거부(DoS) 공격을 유발하는 것을 방지**합니다. 이를 통해 시스템 전체의 안정성과 성능을 유지할 수 있습니다.

#### 3. 케이퍼빌러티 (Capabilities)
루트(root) 사용자는 Linux 시스템에서 매우 강력한 권한을 가지고 있지만, 컨테이너를 루트로 실행하면 보안에 큰 위험이 따를 수 있습니다. 이를 방지하기 위해 **케이퍼빌러티(capabilities)**를 사용합니다.

**케이퍼빌러티**는 루트 권한을 세분화하여 특정 권한만을 컨테이너에 부여하는 기술입니다. 이를 통해 컨테이너가 특정 작업에 필요한 최소한의 권한만 갖도록 하여 보안을 강화할 수 있습니다. 예를 들어:

- **CAP_CHOWN**: 파일의 소유권을 변경할 수 있는 권한.
- **CAP_NET_BIND_SERVICE**: 낮은 번호의 네트워크 포트(예: 80, 443)에 소켓을 바인딩할 수 있는 권한.
- **CAP_SETUID**: 프로세스의 권한 수준을 변경할 수 있는 권한.
- **CAP_SYS_BOOT**: 시스템을 재부팅할 수 있는 권한.

Docker는 이러한 케이퍼빌러티를 활용하여 **필요한 최소 권한만 부여**하고 나머지 루트 권한을 제거함으로써, 컨테이너가 불필요하게 강력한 권한을 갖지 않도록 합니다. 이를 **최소 권한 원칙(Least Privilege)**이라고 하며, 보안을 크게 강화할 수 있습니다.

#### 4. 강제 접근 제어 시스템 (Mandatory Access Control, MAC)
Docker는 **강제 접근 제어(MAC)** 시스템으로 **AppArmor**와 **SELinux**를 사용합니다. 이는 컨테이너의 접근 권한을 엄격하게 제한하고, 시스템 자원에 대한 접근 제어를 관리하는 보안 기능입니다.

- **AppArmor**는 경로 기반의 접근 제어 모델을 사용하여 특정 파일이나 디렉터리에 대한 접근을 제어합니다.
- **SELinux**는 레이블 기반의 보안 모델을 사용하여 더욱 정밀한 접근 제어를 제공합니다.

Docker는 기본적으로 **적당히 보호적이면서도 넓은 애플리케이션 호환성을 제공**하는 기본 보안 프로파일을 제공하며, 사용자가 필요에 따라 이를 커스터마이징할 수 있습니다. 그러나 이 설정은 복잡할 수 있기 때문에 기본값을 사용하는 경우가 많습니다.

#### 5. seccomp
**seccomp**는 **컨테이너가 호출할 수 있는 시스템 호출(syscall)**을 제한하는 보안 기술입니다. 이를 통해 컨테이너가 호스트 커널에 대해 잠재적으로 위험한 시스템 호출을 실행하지 못하도록 제한합니다. Docker는 기본적으로 **적절한 보안 수준을 제공하는 seccomp 프로파일**을 사용하며, 사용자는 필요에 따라 이를 커스터마이징할 수 있습니다.

#### 6. Docker Swarm 모드의 보안
**Docker Swarm**은 여러 Docker 호스트를 클러스터로 묶어 **애플리케이션을 선언적으로 배포**할 수 있는 기술입니다. Swarm 모드는 기본적으로 다양한 보안 기능을 제공합니다.

- **암호화된 노드 ID**와 **TLS를 이용한 상호 인증**을 통해 클러스터 내의 안전한 통신을 보장합니다.
- **CA 구성과 자동 인증서 회전** 기능으로 인증서를 자동으로 관리합니다.
- **암호화된 클러스터 저장소와 네트워크**를 통해 데이터의 무결성을 보호합니다.

**Swarm 클러스터**는 **매니저(manager)**와 **워커(worker)** 노드로 구성됩니다. 매니저 노드는 클러스터의 제어 평면을 호스팅하며 클러스터를 구성하고 작업을 할당하는 역할을 하고, 워커 노드는 애플리케이션 코드를 컨테이너로 실행하는 역할을 합니다.

#### 7. Swarm 조인 토큰 (Swarm Join Tokens)
Swarm 클러스터에 새로운 매니저나 워커 노드를 추가하기 위해 **조인 토큰(join token)**이 필요합니다. Swarm 클러스터는 **매니저용**과 **워커용** 두 가지 조인 토큰을 관리하며, 각각의 토큰은 클러스터에 특정한 역할을 부여합니다. 조인 토큰은 다음과 같은 형식으로 이루어집니다:

```
PREFIX - VERSION - SWARM ID - TOKEN
```

- **PREFIX**: 항상 `SWMTKN`으로 시작하여 패턴을 쉽게 식별할 수 있도록 합니다.
- **VERSION**: Swarm의 버전을 나타냅니다.
- **SWARM ID**: Swarm 인증서의 해시 값으로 클러스터의 고유성을 나타냅니다.
- **TOKEN**: 매니저 또는 워커로 조인할 수 있는 권한을 결정하는 부분입니다.

조인 토큰은 매우 중요한 정보이므로, 이를 안전하게 보관하고 유출되지 않도록 주의해야 합니다. 만약 조인 토큰이 유출되었다고 의심되면, 단일 명령어로 **기존 토큰을 회수하고 새로운 토큰을 발급**할 수 있습니다.

```sh
$ docker swarm join-token --rotate manager
```

이 명령어를 통해 새로운 매니저 조인 토큰을 발급하고, 이를 사용하여 새 매니저를 Swarm에 추가할 수 있습니다. 기존 매니저는 업데이트할 필요가 없으며, 새로 추가되는 매니저만 새로운 토큰을 사용해야 합니다.

### 결론
Docker는 다양한 **Linux 보안 기술**과 **자체적인 보안 기능**을 통해 컨테이너 환경의 보안을 강화합니다. **네임스페이스**와 **컨트롤 그룹(cgroups)**을 통해 각 컨테이너를 격리하고 자원을 제한하며, **케이퍼빌러티(capabilities)**를 통해 필요한 최소 권한만 부여합니다. **강제 접근 제어(MAC)** 시스템과 **seccomp**는 컨테이너의 시스템 접근을 세부적으로 제어하여 보안을 더욱 강화합니다. **Docker Swarm 모드**는 클러스터 내 노드 간의 안전한 통신과 인증, 암호화된 네트워크와 저장소를 통해 **안전하고 고가용성(HA)을 갖춘 클러스터 환경**을 제공합니다.

이러한 보안 기술들은 함께 작동하여 Docker의 컨테이너 환경을 안전하게 유지하고, 시스템의 안정성과 무결성을 보장합니다. 